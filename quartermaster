#!/usr/bin/env python3

from quarters.master.jobfetcher import JobFetcher

import quarters.config

from multiprocessing import Manager

from quarters.master.spout import start_master_web

if __name__ == '__main__':
    manager = Manager()
    job_states = manager.dict()

    pending_jobs = manager.Queue()

    config = quarters.config.read_master('conf/master.conf')
    print( config )

    # set maximum number of simultaneous chroots
    jf = JobFetcher( job_states, pending_jobs, config )
    jf.start()

    # get it up!
    start_master_web( job_states, pending_jobs, config['master_port'] )
